<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Tango Device Server Python API &mdash; PyTango v7.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.1.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="PyTango v7.1.0 documentation" href="../index.html" />
    <link rel="next" title="Device classes" href="device.html" />
    <link rel="prev" title="The Tango Database Python API" href="../database.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="device.html" title="Device classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../database.html" title="The Tango Database Python API"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">PyTango v7.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">The Tango Device Server Python API</a><ul>
<li><a class="reference external" href="#importing-python-modules">Importing python modules</a></li>
<li><a class="reference external" href="#the-main-part-of-a-python-device-server">The main part of a Python device server</a></li>
<li><a class="reference external" href="#the-pydsexpclass-class-in-python">The PyDsExpClass class in Python</a></li>
<li><a class="reference external" href="#defining-commands">Defining commands</a></li>
<li><a class="reference external" href="#defining-attributes">Defining attributes</a></li>
<li><a class="reference external" href="#the-pydsexp-class-in-python">The PyDsExp class in Python</a><ul>
<li><a class="reference external" href="#general-methods">General methods</a></li>
<li><a class="reference external" href="#implementing-a-command">Implementing a command</a></li>
<li><a class="reference external" href="#implementing-an-attribute">Implementing an attribute</a></li>
<li><a class="reference external" href="#dynamic-attributes">Dynamic attributes</a></li>
</ul>
</li>
<li><a class="reference external" href="#mixing-tango-classes-python-and-c-in-a-python-tango-device-server">Mixing Tango classes (Python and C++) in a Python Tango device server</a></li>
<li><a class="reference external" href="#server-api">Server API</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../database.html"
                                  title="previous chapter">The Tango Database Python API</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="device.html"
                                  title="next chapter">Device classes</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/server/index.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-tango-device-server-python-api">
<h1>The Tango Device Server Python API<a class="headerlink" href="#the-tango-device-server-python-api" title="Permalink to this headline">¶</a></h1>
<p>This chapter does not explain what a Tango device or a device server is.
This is explained in details in &#8220;The Tango control system manual&#8221; available at
<a class="reference external" href="http://www.tango-controls.org/TangoKernel">http://www.tango-controls.org/TangoKernel</a>.
The device server we will detailed in the following example is a Tango device
server with one Tango class called PyDsExp. This class has two commands called
IOLong and IOStringArray and two attributes called Long_attr and Short_attr_rw.</p>
<div class="section" id="importing-python-modules">
<h2>Importing python modules<a class="headerlink" href="#importing-python-modules" title="Permalink to this headline">¶</a></h2>
<p>To write a Python script which is a Tango device server, you need to import two modules which are :</p>
<ol class="arabic simple">
<li>The PyTango module which is the Python to C++ interface</li>
<li>The Python classical sys module</li>
</ol>
<p>This could be done with code like (supposing the PYTHONPATH environment variable is correctly set):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">import</span> <span class="nn">PyTango</span>
<span class="k">import</span> <span class="nn">sys</span>
</pre></div>
</div>
</div>
<div class="section" id="the-main-part-of-a-python-device-server">
<h2>The main part of a Python device server<a class="headerlink" href="#the-main-part-of-a-python-device-server" title="Permalink to this headline">¶</a></h2>
<p>The rule of this part of a Tango device server is to:
- Create the PyUtil object passing it the Python interpreter command line arguments
- Add to this object the list of Tango class(es) which have to be hosted by this interpreter
- Initialise the device server
- Run the device server loop</p>
<p>The following is a typical code for this main function:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">py</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">Util</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">py</span><span class="o">.</span><span class="n">add_TgClass</span><span class="p">(</span><span class="n">PyDsExpClass</span><span class="p">,</span><span class="n">PyDsExp</span><span class="p">,</span><span class="s">&#39;PyDsExp&#39;</span><span class="p">)</span>

    <span class="n">U</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">U</span><span class="o">.</span><span class="n">server_init</span><span class="p">()</span>
    <span class="n">U</span><span class="o">.</span><span class="n">server_run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt><strong>Line 2</strong></dt>
<dd>Create the Util object passing it the interpreter command line arguments</dd>
<dt><strong>Line 3</strong></dt>
<dd>Add the Tango class &#8216;PyDsExp&#8217; to the device server. The add_TgClass()
method of the Util class has three arguments which are the Tango class
PyDsExpClass instance, the Tango PyDsExp instance and the Tango class name</dd>
<dt><strong>Line 6</strong></dt>
<dd>Initialise the Tango device server</dd>
<dt><strong>Line 7</strong></dt>
<dd>Run the device server loop</dd>
</dl>
</div>
<div class="section" id="the-pydsexpclass-class-in-python">
<h2>The PyDsExpClass class in Python<a class="headerlink" href="#the-pydsexpclass-class-in-python" title="Permalink to this headline">¶</a></h2>
<p>The rule of this class is to :
- Host and manage data you have only once for the Tango class whatever devices of this class will be created
- Define Tango class command(s)
- Define Tango class attribute(s)</p>
<p>In our example, the code of this Python class looks like:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PyDsExpClass</span><span class="p">(</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DeviceClass</span><span class="p">):</span>

    <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;IOLong&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">[</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">ArgType</span><span class="o">.</span><span class="n">DevLong</span><span class="p">,</span> <span class="s">&quot;Number&quot;</span> <span class="p">],</span>
                              <span class="p">[</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">ArgType</span><span class="o">.</span><span class="n">DevLong</span><span class="p">,</span> <span class="s">&quot;Number * 2&quot;</span> <span class="p">]</span> <span class="p">],</span>
                 <span class="s">&#39;IOStringArray&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">[</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">ArgType</span><span class="o">.</span><span class="n">DevVarStringArray</span><span class="p">,</span> <span class="s">&quot;Array of string&quot;</span> <span class="p">],</span>
                                     <span class="p">[</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">ArgType</span><span class="o">.</span><span class="n">DevVarStringArray</span><span class="p">,</span> <span class="s">&quot;This reversed array&quot;</span><span class="p">]</span> <span class="p">],</span>
    <span class="p">}</span>

    <span class="n">attr_list</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;Long_attr&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">[</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">ArgType</span><span class="o">.</span><span class="n">DevLong</span> <span class="p">,</span>
                                    <span class="n">PyTango</span><span class="o">.</span><span class="n">AttrDataFormat</span><span class="o">.</span><span class="n">SCALAR</span> <span class="p">,</span>
                                    <span class="n">PyTango</span><span class="o">.</span><span class="n">AttrWriteType</span><span class="o">.</span><span class="n">READ</span><span class="p">],</span>
                                  <span class="p">{</span> <span class="s">&#39;min alarm&#39;</span> <span class="p">:</span> <span class="mf">1000</span><span class="p">,</span> <span class="s">&#39;max alarm&#39;</span> <span class="p">:</span> <span class="mf">1500</span> <span class="p">}</span> <span class="p">],</span>

                 <span class="s">&#39;Short_attr_rw&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">[</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">ArgType</span><span class="o">.</span><span class="n">DevShort</span><span class="p">,</span>
                                       <span class="n">PyTango</span><span class="o">.</span><span class="n">AttrDataFormat</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">,</span>
                                       <span class="n">PyTango</span><span class="o">.</span><span class="n">AttrWriteType</span><span class="o">.</span><span class="n">READ_WRITE</span> <span class="p">]</span> <span class="p">]</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt><strong>Line 1</strong></dt>
<dd>The PyDsExpClass class has to inherit from the PyTango.PyDeviceClass class</dd>
<dt><strong>Line 3 to 7</strong></dt>
<dd>Definition of the cmd_list dictionnary defining commands. The IOLong command
is defined at lines 3 and 4. The IOStringArray command is defined in line 5 and 6</dd>
<dt><strong>Line 10 to 16</strong></dt>
<dd>Definition of the attr_list dictionnary defining attributes. The Long_attr
attribute is defined at lines 8 to 11 and the Short_attr_rw attribute is
defined at lines 13 to 15</dd>
</dl>
<p>If you have something specific to do in the class constructor like
initializing some specific data member, you will have to code a class
constructor. An example of such a contructor is</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">PyTango</span><span class="o">.</span><span class="n">DeviceClass</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="s">&quot;TestDevice&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The device type is set at line 3.</p>
</div>
<div class="section" id="defining-commands">
<h2>Defining commands<a class="headerlink" href="#defining-commands" title="Permalink to this headline">¶</a></h2>
<p>As shown in the previous example, commands have to be defined in a dictionary called <em>cmd_list</em> as a data
member of the xxxClass class of the Tango class. This dictionary has one element per command. The element
key is the command name. The element value is a Python list which defines the command. The generic form
of a command definition is:</p>
<blockquote>
<tt class="docutils literal"><span class="pre">'cmd_name'</span> <span class="pre">:</span> <span class="pre">[</span> <span class="pre">[in_type,</span> <span class="pre">&lt;&quot;In</span> <span class="pre">desc&quot;&gt;],</span> <span class="pre">[out_type,</span> <span class="pre">&lt;&quot;Out</span> <span class="pre">desc&quot;&gt;],</span> <span class="pre">&lt;{opt</span> <span class="pre">parameters}&gt;]</span></tt></blockquote>
<p>The first element of the value list is itself a list with the command input data type (one of the PyTango.ArgType
pseudo enumeration value) and optionally a string describing this input argument. The second element of the
value list is also a list with the command output data type (one of the PyTango.ArgType pseudo enumeration
value) and optionally a string describing it.        These two elements are mandatory.   The third list element is
optional and allows additional command definition. The authorized element for this dictionary are summarized
in the following array:</p>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="27%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">key</th>
<th class="head">Value</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>&#8220;display level&#8221;</td>
<td>DispLevel enum value</td>
<td>The command display level</td>
</tr>
<tr><td>&#8220;polling period&#8221;</td>
<td>Any number</td>
<td>The command polling period (mS)</td>
</tr>
<tr><td>&#8220;default command&#8221;</td>
<td>True or False</td>
<td>To define that it is the default command</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
<div class="section" id="defining-attributes">
<h2>Defining attributes<a class="headerlink" href="#defining-attributes" title="Permalink to this headline">¶</a></h2>
<p>As shown in the previous example, attributes have to be defined in a dictionary called <strong>attr_list</strong> as a data
member of the xxxClass class of the Tango class. This dictionary has one element per attribute. The element
key is the attribute name. The element value is a Python list which defines the attribute. The generic form of
an attribute definition is:</p>
<blockquote>
<tt class="docutils literal"><span class="pre">'attr_name'</span> <span class="pre">:</span> <span class="pre">[</span> <span class="pre">[mandatory</span> <span class="pre">parameters],</span> <span class="pre">&lt;{opt</span> <span class="pre">parameters}&gt;]</span></tt></blockquote>
<p>For any kind of attributes, the mandatory parameters are:</p>
<blockquote>
<tt class="docutils literal"><span class="pre">[attr</span> <span class="pre">data</span> <span class="pre">type,</span> <span class="pre">attr</span> <span class="pre">data</span> <span class="pre">format,</span> <span class="pre">attr</span> <span class="pre">data</span> <span class="pre">R/W</span> <span class="pre">type]</span></tt></blockquote>
<p>The attribute data type is one of the possible value for attributes of the PyTango.ArgType pseudo enunmeration.
The attribute data format is one of the possible value of the PyTango.AttrDataFormat pseudo enumeration and
the attribute R/W type is one of the possible value of the PyTango.AttrWriteType pseudo enumeration. For
spectrum attribute, you have to add the maximum X size (a number). For image attribute, you have to add
the maximun X and Y dimension (two numbers). The authorized elements for the dictionnary defining optional
parameters are summarized in the following array</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="36%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">key</th>
<th class="head">value</th>
<th class="head">definition</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>&#8220;display level&#8221;</td>
<td>PyTango.DispLevel enum value</td>
<td>The attribute display level</td>
</tr>
<tr><td>&#8220;polling period&#8221;</td>
<td>Any number</td>
<td>The attribute polling period (mS)</td>
</tr>
<tr><td>&#8220;memorized&#8221;</td>
<td>True or True_without_hard_applied</td>
<td>Define if and how the att. is memorized</td>
</tr>
<tr><td>&#8220;label&#8221;</td>
<td>A string</td>
<td>The attribute label</td>
</tr>
<tr><td>&#8220;description&#8221;</td>
<td>A string</td>
<td>The attribute description</td>
</tr>
<tr><td>&#8220;unit&#8221;</td>
<td>A string</td>
<td>The attribute unit</td>
</tr>
<tr><td>&#8220;standard unit&#8221;</td>
<td>A number</td>
<td>The attribute standard unit</td>
</tr>
<tr><td>&#8220;display unit&#8221;</td>
<td>A string</td>
<td>The attribute display unit</td>
</tr>
<tr><td>&#8220;format&#8221;</td>
<td>A string</td>
<td>The attribute display format</td>
</tr>
<tr><td>&#8220;max value&#8221;</td>
<td>A number</td>
<td>The attribute max value</td>
</tr>
<tr><td>&#8220;min value&#8221;</td>
<td>A number</td>
<td>The attribute min value</td>
</tr>
<tr><td>&#8220;max alarm&#8221;</td>
<td>A number</td>
<td>The attribute max alarm</td>
</tr>
<tr><td>&#8220;min alarm&#8221;</td>
<td>A number</td>
<td>The attribute min alarm</td>
</tr>
<tr><td>&#8220;min warning&#8221;</td>
<td>A number</td>
<td>The attribute min warning</td>
</tr>
<tr><td>&#8220;max warning&#8221;</td>
<td>A number</td>
<td>The attribute max warning</td>
</tr>
<tr><td>&#8220;delta time&#8221;</td>
<td>A number</td>
<td>The attribute RDS alarm delta time</td>
</tr>
<tr><td>&#8220;delta val&#8221;</td>
<td>A number</td>
<td>The attribute RDS alarm delta val</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-pydsexp-class-in-python">
<h2>The PyDsExp class in Python<a class="headerlink" href="#the-pydsexp-class-in-python" title="Permalink to this headline">¶</a></h2>
<p>The rule of this class is to implement methods executed by commands and attributes.
In our example, the code of this class looks like:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PyDsExp</span><span class="p">(</span><span class="n">PyTango</span><span class="o">.</span><span class="n">Device_4Impl</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cl</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="n">PyTango</span><span class="o">.</span><span class="n">Device_4Impl</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;In PyDsExp __init__&#39;</span>
        <span class="n">PyDsExp</span><span class="o">.</span><span class="n">init_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;In Python init_device method&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevState</span><span class="o">.</span><span class="n">ON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_short_rw</span> <span class="o">=</span> <span class="mf">66</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_long</span> <span class="o">=</span> <span class="mf">1246</span>

<span class="c">#------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">delete_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;[Device delete_device method] for device&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

<span class="c">#------------------------------------------------------------------</span>
<span class="c"># COMMANDS</span>
<span class="c">#------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">is_IOLong_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">DevState</span><span class="o">.</span><span class="n">ON</span>

    <span class="k">def</span> <span class="nf">IOLong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_data</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;[IOLong::execute] received number&quot;</span><span class="p">,</span><span class="n">in_data</span>
        <span class="n">in_data</span> <span class="o">=</span> <span class="n">in_data</span> <span class="o">*</span> <span class="mf">2</span><span class="p">;</span>
        <span class="k">print</span> <span class="s">&quot;[IOLong::execute] return number&quot;</span><span class="p">,</span><span class="n">in_data</span>
        <span class="k">return</span> <span class="n">in_data</span><span class="p">;</span>

<span class="c">#------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">is_IOStringArray_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">DevState</span><span class="o">.</span><span class="n">ON</span>

    <span class="k">def</span> <span class="nf">IOStringArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_data</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_data</span><span class="p">)</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">);</span>
        <span class="n">out_index</span><span class="o">=</span><span class="mf">0</span>
        <span class="n">out_data</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[IOStringArray::execute] received String&quot;</span><span class="p">,</span><span class="n">in_data</span><span class="p">[</span><span class="n">out_index</span><span class="p">]</span>
            <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">in_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">print</span> <span class="s">&quot;[IOStringArray::execute] return String&quot;</span><span class="p">,</span><span class="n">out_data</span><span class="p">[</span><span class="n">out_index</span><span class="p">]</span>
            <span class="n">out_index</span> <span class="o">+=</span> <span class="mf">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">out_data</span>
        <span class="k">return</span> <span class="n">out_data</span>

<span class="c">#------------------------------------------------------------------</span>
<span class="c"># ATTRIBUTES</span>
<span class="c">#------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">read_attr_hardware</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;In read_attr_hardware&#39;</span>

<span class="c">#------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">read_Long_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_att</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;[PyDsExp::read_attr] attribute name Long_attr&quot;</span>

        <span class="c"># Before PyTango 7.0.0</span>
        <span class="c">#PyTango.set_attribute_value(the_att, self.attr_long)</span>

        <span class="c"># Now:</span>
        <span class="n">the_att</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr_long</span><span class="p">)</span>

<span class="c">#------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">read_Short_attr_rw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_att</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;[PyDsExp::read_attr] attribute name Short_attr_rw&quot;</span>

        <span class="c"># Before PyTango 7.0.0</span>
        <span class="c">#PyTango.set_attribute_value(the_att, self.attr_short_rw)</span>

        <span class="c"># Now:</span>
        <span class="n">the_att</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr_short_rw</span><span class="p">)</span>

<span class="c">#------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">write_Short_attr_rw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_att</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;In write_Short_attr_rw for attribute &quot;</span><span class="p">,</span><span class="n">the_att</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="c"># Before PyTango 7.0.0</span>
        <span class="c">#data = []</span>
        <span class="c">#PyTango.get_write_value(the_att, data)</span>

        <span class="c"># Now:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">the_att</span><span class="o">.</span><span class="n">get_write_value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_short_rw</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt><strong>Line 1</strong></dt>
<dd>The PyDsExp class has to inherit from the PyTango.Device_4Impl</dd>
<dt><strong>Line 3 to 6</strong></dt>
<dd>PyDsExp class constructor. Note that at line 6, it calls the <em>init_device()</em>
method</dd>
<dt><strong>Line 8 to 12</strong></dt>
<dd>The init_device() method. It sets the device state (line 9) and initialises
some data members</dd>
<dt><strong>Line 16 to 17</strong></dt>
<dd>The delete_device() method. This method is not mandatory. You define it
only if you have to do something specific before the device is destroyed</dd>
<dt><strong>Line 23 to 30</strong></dt>
<dd>The two methods for the IOLong command. The first method is called
<em>is_IOLong_allowed()</em> and it is the command is_allowed method (line 23 to 24).
The second method has the same name than the command name. It is the method
which executes the command. The command input data type is a Tango long
and therefore, this method receives a Python integer.</dd>
<dt><strong>Line 34 to 47</strong></dt>
<dd>The two methods for the IOStringArray command. The first method is its
is_allowed method (Line 34 to 35). The second one is the command
execution method (Line 37 to 47). The command input data type is a String
array. Therefore, the method receives the array in a Python list of Python
strings.</dd>
<dt><strong>Line 53 to 54</strong></dt>
<dd>The <em>read_attr_hardware()</em> method. Its argument is a Python sequence of
Python integer.</dd>
<dt><strong>Line 58 to 65</strong></dt>
<dd>The method executed when the Long_attr attribute is read. Note that before
PyTango 7 it sets the attribute value with the PyTango.set_attribute_value
function. Now the same can be done using the set_value of the attribute
object</dd>
<dt><strong>Line 69 to 76</strong></dt>
<dd>The method executed when the Short_attr_rw attribute is read.</dd>
<dt><strong>Line 80 to 89</strong></dt>
<dd>The method executed when the Short_attr_rw attribute is written.
Note that before PyTango 7 it gets the attribute value with a call to the
Attribute method <em>get_write_value</em> with a list as argument. Now the write
value can be obtained as the return value of the <em>get_write_value</em> call. And
in case it is a scalar there is no more the need to extract it from the list.</dd>
</dl>
<div class="section" id="general-methods">
<h3>General methods<a class="headerlink" href="#general-methods" title="Permalink to this headline">¶</a></h3>
<p>The following array summarizes how the general methods we have in a Tango
device server are implemented in Python.</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="35%" />
<col width="18%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Input par (with &#8220;self&#8221;)</th>
<th class="head">return value</th>
<th class="head">mandatory</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>init_device</td>
<td>None</td>
<td>None</td>
<td>Yes</td>
</tr>
<tr><td>delete_device</td>
<td>None</td>
<td>None</td>
<td>No</td>
</tr>
<tr><td>always_executed_hook</td>
<td>None</td>
<td>None</td>
<td>No</td>
</tr>
<tr><td>signal_handler</td>
<td>Python integer</td>
<td>None</td>
<td>No</td>
</tr>
<tr><td>read_attr_hardware</td>
<td>Python list of integer</td>
<td>None</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementing-a-command">
<h3>Implementing a command<a class="headerlink" href="#implementing-a-command" title="Permalink to this headline">¶</a></h3>
<p>Commands are defined as described above. Nevertheless, some methods implementing
them have to be written. These methods names are fixed and depend on command
name. They have to be called:</p>
<blockquote>
<tt class="docutils literal"><span class="pre">is_&lt;Cmd_name&gt;_allowed</span></tt> and <tt class="docutils literal"><span class="pre">&lt;Cmd_name&gt;</span></tt></blockquote>
<p>For instance, with a command called MyCmd, its is_allowed method has to be
called is_MyCmd_allowed and its execution method has to be called simply MyCmd.
The following array gives some more info on these methods.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="32%" />
<col width="25%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Input par (with &#8220;self&#8221;)</th>
<th class="head">return value</th>
<th class="head">mandatory</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>is_&lt;Cmd_name&gt;_allowed</td>
<td>None</td>
<td>Python boolean</td>
<td>No</td>
</tr>
<tr><td>Cmd_name</td>
<td>Depends on cmd type</td>
<td>Depends on cmd type</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>Tango has more data types than Python which is more dynamic. How Tango data are
transferred to Python method implementing commands is described in the following array:</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Tango data type</th>
<th class="head">Python type</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>DEV_VOID</td>
<td>No data</td>
</tr>
<tr><td>DEV_BOOLEAN</td>
<td>bool</td>
</tr>
<tr><td>DEV_SHORT</td>
<td>int</td>
</tr>
<tr><td>DEV_LONG</td>
<td>int</td>
</tr>
<tr><td>DEV_LONG64</td>
<td>long (on a 32 bits computer) or
int (on a 64 bits computer)</td>
</tr>
<tr><td>DEV_FLOAT</td>
<td>float</td>
</tr>
<tr><td>DEV_DOUBLE</td>
<td>float</td>
</tr>
<tr><td>DEV_USHORT</td>
<td>int</td>
</tr>
<tr><td>DEV_ULONG</td>
<td>int</td>
</tr>
<tr><td>DEV_ULONG64</td>
<td>long (on a 32 bits computer) or
int (on a 64 bits computer)</td>
</tr>
<tr><td>DEV_STRING</td>
<td>str</td>
</tr>
<tr><td>DEVVAR_CHARARRAY</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEVVAR_SHORTARRAY</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEVVAR_LONGARRAY</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEVVAR_LONG64ARRAY</td>
<td>sequence&lt;long&gt; (on a 32 bits computer) or
sequence&lt;int&gt; (on a 64 bits computer)</td>
</tr>
<tr><td>DEVVAR_FLOATARRAY</td>
<td>sequence&lt;float&gt;</td>
</tr>
<tr><td>DEVVAR_DOUBLEARRAY</td>
<td>sequence&lt;float&gt;</td>
</tr>
<tr><td>DEVVAR_USHORTARRAY</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEVVAR_ULONGARRAY</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEVVAR_ULONG64ARRAY</td>
<td>sequence&lt;long&gt; (on a 32 bits computer) or
sequence&lt;int&gt; (on a 64 bits computer)</td>
</tr>
<tr><td>DEVVAR_STRINGARRAY</td>
<td>sequence&lt;str&gt;</td>
</tr>
<tr><td>DEVVAR_LONGSTRINGARRAY</td>
<td><dl class="first last docutils">
<dt>A sequence with two elements:</dt>
<dd><ol class="first last arabic simple">
<li>sequence&lt;int&gt;</li>
<li>sequence&lt;str&gt;</li>
</ol>
</dd>
</dl>
</td>
</tr>
<tr><td>DEVVAR_DOUBLESTRINGARRAY</td>
<td><dl class="first last docutils">
<dt>A sequence with two elements:</dt>
<dd><ol class="first last arabic simple">
<li>sequence&lt;float&gt;</li>
<li>sequence&lt;str&gt;</li>
</ol>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>The following code is an example of how you write code executed when a client
read an attribute which is called Long_attr:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">read_Long_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_att</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;[PyDsExp::read_attr] attribute name Long_attr&quot;</span>
    <span class="n">the_att</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr_long</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt><strong>Line 1</strong></dt>
<dd>Method declaration with &#8220;the_att&#8221; being an instance of the Attribute class
representing the Long_attr attribute</dd>
<dt><strong>Line 3</strong></dt>
<dd>Set the attribute value using the method set_value() with the attribute
value as parameter</dd>
</dl>
<p>The following code is an example of how you write code executed when a client
write the Short_attr_rw attribute:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">write_Short_attr_rw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_att</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;In write_Short_attr_rw for attribute &quot;</span><span class="p">,</span><span class="n">the_att</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attr_short_rw</span> <span class="o">=</span> <span class="n">the_att</span><span class="o">.</span><span class="n">get_write_value</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt><strong>Line 1</strong></dt>
<dd>Method declaration with &#8220;the_att&#8221; being an instance of the Attribute class
representing the Short_attr_rw attribute</dd>
<dt><strong>Line 3</strong></dt>
<dd>Get the value sent by the client using the method <em>get_write_value()</em> and
store it in the device object. Our attribute is a scalar short attribute so
the return value is an int.</dd>
</dl>
</div>
<div class="section" id="implementing-an-attribute">
<h3>Implementing an attribute<a class="headerlink" href="#implementing-an-attribute" title="Permalink to this headline">¶</a></h3>
<p>Attributes are defined as described in chapter 5.3.2. Nevertheless, some methods
implementing them have to be written. These methods names are fixed and depend
on attribute name. They have to be called:</p>
<blockquote>
<tt class="docutils literal"><span class="pre">is_&lt;Attr_name&gt;_allowed</span></tt> and <tt class="docutils literal"><span class="pre">read_&lt;Attr_name&gt;</span></tt> or/and <tt class="docutils literal"><span class="pre">write_&lt;Attr_name&gt;</span></tt></blockquote>
<p>For instance, with an attribute called MyAttr, its is_allowed method has to be
called is_MyAttr_allowed, its read method has to be called read_MyAttr and
its write method has to be called write_MyAttr. The following array gives some
more info on these methods.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="28%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">data format</th>
<th class="head">data type</th>
<th class="head">python type</th>
</tr>
</thead>
<tbody valign="top">
<tr><td rowspan="11">SCALAR</td>
<td>DEV_BOOLEAN</td>
<td>bool</td>
</tr>
<tr><td>DEV_UCHAR</td>
<td>int</td>
</tr>
<tr><td>DEV_SHORT</td>
<td>int</td>
</tr>
<tr><td>DEV_USHORT</td>
<td>int</td>
</tr>
<tr><td>DEV_LONG</td>
<td>int</td>
</tr>
<tr><td>DEV_ULONG</td>
<td>int</td>
</tr>
<tr><td>DEV_LONG64</td>
<td>int/long</td>
</tr>
<tr><td>DEV_ULONG64</td>
<td>int/long</td>
</tr>
<tr><td>DEV_FLOAT</td>
<td>float</td>
</tr>
<tr><td>DEV_DOUBLE</td>
<td>float</td>
</tr>
<tr><td>DEV_STRING</td>
<td>str</td>
</tr>
<tr><td rowspan="11">SPECTRUM
or
IMAGE</td>
<td>DEV_BOOLEAN</td>
<td>sequence&lt;bool&gt;</td>
</tr>
<tr><td>DEV_UCHAR</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEV_SHORT</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEV_USHORT</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEV_LONG</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEV_ULONG</td>
<td>sequence&lt;int&gt;</td>
</tr>
<tr><td>DEV_LONG64</td>
<td>sequence&lt;int/long&gt;</td>
</tr>
<tr><td>DEV_ULONG64</td>
<td>sequence&lt;int/long&gt;</td>
</tr>
<tr><td>DEV_FLOAT</td>
<td>sequence&lt;float&gt;</td>
</tr>
<tr><td>DEV_DOUBLE</td>
<td>sequence&lt;float&gt;</td>
</tr>
<tr><td>DEV_STRING</td>
<td>sequence&lt;str&gt;</td>
</tr>
</tbody>
</table>
<p>For SPECTRUM and IMAGES the actual sequence object used depends on the context
where the tango data is used, and the availability of <tt class="docutils literal"><span class="pre">numpy</span></tt>.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>for properties the sequence is always a <tt class="docutils literal"><span class="pre">list</span></tt></dt>
<dd><p class="first">Example:</p>
<div class="last highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">import</span> <span class="nn">PyTango</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_property</span><span class="p">([</span><span class="s">&quot;TangoSynchrotrons&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">&lt;type &#39;list&#39;&gt;</span>
</pre></div>
</td></tr></table></div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>for attribute/command values</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">numpy.ndarray</span></tt> if PyTango was compiled with numpy support (default) and <tt class="docutils literal"><span class="pre">numpy</span></tt> is installed.</li>
<li><tt class="docutils literal"><span class="pre">list</span></tt> otherwise</li>
</ul>
</dd>
</dl>
</li>
</ol>
<p>The following code is an example of how you write code executed when a client read an attribute which is
called Long_attr:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">read_Long_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_att</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;[PyDsExp::read_attr] attribute name Long_attr&quot;</span>
    <span class="n">the_att</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr_long</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt><strong>Line 1</strong></dt>
<dd>Method declaration with &#8220;the_att&#8221; being an instance of the Attribute
class representing the Long_attr attribute</dd>
<dt><strong>Line 3</strong></dt>
<dd>Set the attribute value using the method set_value() with the attribute
value as parameter.</dd>
</dl>
<p>The following code is an example of how you write code executed when a client
write the Short_attr_rw attribute:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">write_Short_attr_rw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">the_att</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;In write_Short_attr_rw for attribute &quot;</span><span class="p">,</span><span class="n">the_att</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attr_short_rw</span> <span class="o">=</span> <span class="n">the_att</span><span class="o">.</span><span class="n">get_write_value</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt><strong>Line 1</strong></dt>
<dd>Method declaration with &#8220;the_att&#8221; being an instance of the Attribute
class representing the Short_attr_rw attribute</dd>
<dt><strong>Line 3</strong></dt>
<dd>Get the value sent by the client using the method get_write_value() and
store the value written in the device object. Our attribute is a scalar
short attribute so the return value is an int</dd>
</dl>
</div>
<div class="section" id="dynamic-attributes">
<h3>Dynamic attributes<a class="headerlink" href="#dynamic-attributes" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to create dynamic attributes within a Python device server.
There are several ways to create dynamic attributes. One of the way, is to
create all the devices within a loop, then to create the dynamic attributes and
finally to make all the devices available for the external world. In C++ device
server, this is typically done within the &lt;Device&gt;Class::device_factory() method.
In Python device server, this method is generic and the user does not have one.
Nevertheless, this generic device_factory method calls a method named dyn_attr()
allowing the user to create his dynamic attributes. It is simply necessary to
re-define this method within your &lt;Device&gt;Class and to create the dynamic
attribute within this method:</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">dyn_attr(self,</span> <span class="pre">dev_list)</span></tt></p>
<p>where dev_list is a list containing all the devices created by the
generic device_factory() method.</p>
</blockquote>
<p>There is another point to be noted regarding dynamic attribute within Python
device server. The Tango Python device server core checks that for each
attribute it exists methods named &lt;attribute_name&gt;_read and/or &lt;attribute_name&gt;_write and/or
is_&lt;attribute_name&gt;_allowed. Using dynamic attribute, it is not possible to
define these methods because attributes name and number are known only at run-time.
To address this issue, the Device_3Impl::add_attribute() method has a diferent
signature for Python device server which is:</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">add_attribute(self,</span> <span class="pre">attr,</span> <span class="pre">r_meth</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">w_meth</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">is_allo_meth</span> <span class="pre">=</span> <span class="pre">None)</span></tt></p>
<p>attr is an instance of the Attr class, r_meth is the method which has to be
executed with the attribute is read, w_meth is the method to be executed
when the attribute is written and is_allo_meth is the method to be executed
to implement the attribute state machine. The method passed here as argument
as to be class method and not object method. Which argument you have to use
depends on the type of the attribute (A WRITE attribute does not need a
read method). Note, that depending on the number of argument you pass to this
method, you may have to use Python keyword argument. The necessary methods
required by the Tango Python device server core will be created automatically
as a forward to the methods given as arguments.</p>
</blockquote>
</div>
</div>
<div class="section" id="mixing-tango-classes-python-and-c-in-a-python-tango-device-server">
<h2>Mixing Tango classes (Python and C++) in a Python Tango device server<a class="headerlink" href="#mixing-tango-classes-python-and-c-in-a-python-tango-device-server" title="Permalink to this headline">¶</a></h2>
<p>Within the same python interpreter, it is possible to mix several Tango classes.
Here is an example of the main function of a device server with two Tango classes
called IRMiror and PLC:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="highlight"><pre><span class="k">import</span> <span class="nn">PyTango</span>
<span class="k">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">py</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">Util</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">py</span><span class="o">.</span><span class="n">add_TgClass</span><span class="p">(</span><span class="n">PLCClass</span><span class="p">,</span><span class="n">PLC</span><span class="p">,</span><span class="s">&#39;PLC&#39;</span><span class="p">)</span>
    <span class="n">py</span><span class="o">.</span><span class="n">add_TgClass</span><span class="p">(</span><span class="n">IRMirrorClass</span><span class="p">,</span><span class="n">IRMirror</span><span class="p">,</span><span class="s">&#39;IRMirror&#39;</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">U</span><span class="o">.</span><span class="n">server_init</span><span class="p">()</span>
    <span class="n">U</span><span class="o">.</span><span class="n">server_run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Line 6:</th><td class="field-body">The Tango class PLC is registered in the device server</td>
</tr>
<tr class="field"><th class="field-name">Line 7:</th><td class="field-body">The Tango class IRMirror is registered in the device server</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>It is also possible to add C++ Tango class in a Python device server as soon as:</dt>
<dd><ol class="first last arabic simple">
<li>The Tango class is in a shared library</li>
<li>It exist a C function to create the Tango class</li>
</ol>
</dd>
</dl>
<p>For a Tango class called MyTgClass, the shared library has to be called
MyTgClass.so and has to be in a directory listed in the LD_LIBRARY_PATH
environment variable. The C function creating the Tango class has to be called
_create_MyTgClass_class() and has to take one parameter of type &#8220;char *&#8221; which
is the Tango class name. Here is an example of the main function of the same
device server than before but with one C++ Tango class called SerialLine:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td class="code"><div class="highlight"><pre><span class="k">import</span> <span class="nn">PyTango</span>
<span class="k">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">py</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">Util</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">py</span><span class="o">.</span><span class="n">add_Cpp_TgClass</span><span class="p">(</span><span class="s">&#39;SerialLine&#39;</span><span class="p">,</span> <span class="s">&#39;SerialLine&#39;</span><span class="p">)</span>
    <span class="n">py</span><span class="o">.</span><span class="n">add_TgClass</span><span class="p">(</span><span class="n">PLCClass</span><span class="p">,</span> <span class="n">PLC</span><span class="p">,</span> <span class="s">&#39;PLC&#39;</span><span class="p">)</span>
    <span class="n">py</span><span class="o">.</span><span class="n">add_TgClass</span><span class="p">(</span><span class="n">IRMirrorClass</span><span class="p">,</span> <span class="n">IRMirror</span><span class="p">,</span> <span class="s">&#39;IRMirror&#39;</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">U</span><span class="o">.</span><span class="n">server_init</span><span class="p">()</span>
    <span class="n">U</span><span class="o">.</span><span class="n">server_run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Line 6:</th><td class="field-body">The C++ class is registered in the device server</td>
</tr>
<tr class="field"><th class="field-name">Line 8 and 9:</th><td class="field-body">The two Python classes are registered in the device server</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="server-api">
<h2>Server API<a class="headerlink" href="#server-api" title="Permalink to this headline">¶</a></h2>
<ul>
<li class="toctree-l1"><a class="reference external" href="device.html">Device classes</a><ul>
<li class="toctree-l2"><a class="reference external" href="device.html#deviceimpl">DeviceImpl</a></li>
<li class="toctree-l2"><a class="reference external" href="device.html#device-2impl">Device_2Impl</a></li>
<li class="toctree-l2"><a class="reference external" href="device.html#device-3impl">Device_3Impl</a></li>
<li class="toctree-l2"><a class="reference external" href="device.html#device-4impl">Device_4Impl</a></li>
<li class="toctree-l2"><a class="reference external" href="device.html#dserver">DServer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="device_class.html">DeviceClass</a></li>
<li class="toctree-l1"><a class="reference external" href="attribute.html">Attribute classes</a><ul>
<li class="toctree-l2"><a class="reference external" href="attribute.html#attr">Attr</a></li>
<li class="toctree-l2"><a class="reference external" href="attribute.html#attribute">Attribute</a></li>
<li class="toctree-l2"><a class="reference external" href="attribute.html#wattribute">WAttribute</a></li>
<li class="toctree-l2"><a class="reference external" href="attribute.html#multiattribute">MultiAttribute</a></li>
<li class="toctree-l2"><a class="reference external" href="attribute.html#userdefaultattrprop">UserDefaultAttrProp</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="util.html">Util</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="device.html" title="Device classes"
             >next</a> |</li>
        <li class="right" >
          <a href="../database.html" title="The Tango Database Python API"
             >previous</a> |</li>
        <li><a href="../index.html">PyTango v7.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, ALBA - CELLS.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
  </body>
</html>